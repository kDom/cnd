!function(t){var a=function(t){var a=t.document,e={},n={},i="watermark",o=!1,r="bottom-right",s="watermark.png?"+ +new Date,h=127.5,m=function(){e=a.createElement("canvas"),e.style.cssText="display:none;",n=e.getContext("2d"),a.body.appendChild(e)},d=function(){o=new Image,o.src="",o.src=s,255!=h?o.complete?c():o.onload=function(){c()}:applyWatermarks()},c=function(){var t=o.width||o.offsetWidth,a=o.height||o.offsetHeight;setCanvasSize(t,a),n.drawImage(o,0,0);for(var i=n.getImageData(0,0,t,a),r=i.data,s=r.length,m=3;s>m;m+=4)r[m]=r[m]<h?r[m]:h;i.data=r,n.putImageData(i,0,0),o.onload=null,o.src="",o.src=e.toDataURL(),o.width=t,o.height=a,applyWatermarks()},l=function(t){t.watermark&&(o=t.watermark),t.path&&(s=t.path),t.position&&(r=t.position),t.opacity&&(h=255/(100/t.opacity)),t.className&&(i=t.className),m(),d()};return setCanvasSize=function(t,a){e.width=t,e.height=a},applyWatermark=function(t){e.width=t.dataset.width||t.offsetWidth,e.height=t.dataset.height||t.offsetHeight,n.drawImage(t,0,0);var a=r,i=0,s=0;s=-1!=a.indexOf("top")?10:e.height-o.height-10,i=-1!=a.indexOf("left")?10:e.width-o.width-10,n.drawImage(o,i,s),t.onload=null,t.src=e.toDataURL(),$(t).removeClass("watermark")},applyWatermarks=function(){setTimeout(function(){for(var t=a.getElementsByClassName(i),e=t.length;e--;){var n=t[e];"IMG"==n.tagName.toUpperCase()&&(n.complete?applyWatermark(n):n.onload=function(){applyWatermark(this)})}},10)},{init:function(t){l(t)}}}(t);t.wmark=a}(window);
